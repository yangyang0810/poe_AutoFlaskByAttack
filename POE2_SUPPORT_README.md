# POE2 支持功能说明

## 新增功能概述

本次更新为程序添加了 Path of Exile 2 (POE2) 的支持，采用Tab页面设计，用户可以手动选择使用POE1或POE2模式。POE2模式主要通过血量和蓝量监控来自动触发药水使用。

## 主要改动

### 1. Tab页面设计
- 程序现在使用Tab页面来区分POE1和POE2功能
- POE1 Tab: 保持原有的定时药水和buff功能
- POE2 Tab: 新增的自动药水功能，基于血量蓝量阈值触发
- 窗口标题会根据当前选中的Tab动态更新

### 2. POE2 自动药水功能
在POE2 Tab中包含完整的自动药水控制面板：

#### 自动药水设置：
- **启用自动药水**: 开启/关闭 POE2 自动药水功能
- **血药按键**: 设置血药对应的按键（支持按键设置）
- **蓝药按键**: 设置蓝药对应的按键（支持按键设置）

#### 触发阈值设置：
- **血量阈值**: 设置触发血药的血量百分比 (10-90%)，默认 70%
- **蓝量阈值**: 设置触发蓝药的蓝量百分比 (10-90%)，默认 50%

#### 状态显示：
- **当前血量**: 实时显示当前血量百分比
- **当前蓝量**: 实时显示当前蓝量百分比  
- **药水状态**: 显示药水触发状态（待机/触发血药/触发蓝药）

#### 配置文件设置：
```ini
[poe2_auto_flask]
enabled=False
health_threshold=70
mana_threshold=50
health_flask_key=1
mana_flask_key=2
check_interval=0.2
```

### 3. 智能血量/蓝量监控
- 基于屏幕区域截图分析血量和蓝量
- 针对不同游戏使用不同的UI坐标配置
- 实时监控并在达到阈值时自动触发药水

## 使用方法

### 基本设置
1. 启动程序
2. 根据要玩的游戏选择相应的Tab页面：
   - **POE1 Tab**: 使用原有的定时药水功能
   - **POE2 Tab**: 使用新的自动药水功能
3. 在POE2 Tab中进行设置：
   - 勾选 "启用自动药水" 复选框
   - 设置血药和蓝药的按键
   - 设置血量阈值（推荐 60-80%）
   - 设置蓝量阈值（推荐 40-60%）

### 药水按键配置
在POE2 Tab中直接设置药水按键：
- **血药按键**: 点击输入框，按下对应按键进行设置
- **蓝药按键**: 点击输入框，按下对应按键进行设置
- 支持字母、数字等常用按键

### 工作原理
1. 切换到POE2 Tab时，程序进入POE2模式
2. 启用自动药水后，开始血量/蓝量监控
3. 每 0.2 秒检测一次血量和蓝量状态（可配置）
4. 当血量低于设定阈值时，自动按下血药按键
5. 当蓝量低于设定阈值时，自动按下蓝药按键
6. 内置 1 秒冷却时间，避免频繁触发
7. 状态显示区域实时更新血量、蓝量和药水触发状态

## 注意事项

### 坐标配置
不同游戏的血量/蓝量条位置可能不同，如需调整可修改 `utils/health_monitor.py` 中的坐标配置：

```python
'poe2': {
    'health': {
        'x_start': 0.02, 'y_start': 0.88,
        'x_end': 0.25, 'y_end': 0.93
    },
    'mana': {
        'x_start': 0.75, 'y_start': 0.88,
        'x_end': 0.98, 'y_end': 0.93
    }
}
```

### 兼容性
- 完全向下兼容 POE1 的所有原有功能
- POE1 和 POE2 通过Tab页面分离，互不干扰
- POE1 Tab保持原有的定时药水和buff功能
- POE2 Tab提供全新的自动药水功能
- 可以随时在两个模式间切换

### 性能优化
- 只有在检测到 POE2 且启用自动药水时才会进行屏幕截图
- 使用相对坐标，支持不同分辨率
- 智能冷却机制避免资源浪费

## 调试信息

程序运行时会在控制台输出调试信息：
- 游戏切换检测
- 药水触发事件
- 阈值更新确认

## 故障排除

### 如果自动药水不工作：
1. 确认已勾选 "启用" 复选框
2. 检查血量/蓝量阈值设置是否合理
3. 确认药水按键配置正确
4. 检查控制台是否有错误信息

### 坐标调整：
如果血量/蓝量检测不准确，可能需要调整UI坐标，建议：
1. 截图查看血量条在屏幕中的位置
2. 根据相对位置调整坐标配置
3. 重启程序测试效果

## 配置示例

一个完整的 POE2 配置示例：
```ini
[poe2_auto_flask]
enabled=True
health_threshold=75
mana_threshold=45
health_flask_key=1
mana_flask_key=2
check_interval=0.2
```

这样配置后，程序会在血量低于 75% 时自动按下 "1" 键，在蓝量低于 45% 时自动按下 "2" 键。
